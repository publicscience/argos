- from 'mixins/mentions.jade' import mentions
- from 'mixins/articles.jade' import articles

extends layouts/main.jade

block content
    .bounds
        article.entity.clearfix
            .entity--hero(style='background-image:url("'+event.image+'")')
            .entity--body.clearfix
                .entity--content
                    section
                        ul.actions.list__horizontal__justify
                            li
                                span.icon-watch
                                | Watch
                            li
                                span.icon-bookmark
                                | Bookmark
                            li
                                span.icon-discuss
                                | Discuss
                            li
                                span.icon-share
                                | Share
                            li
                                span.icon-promote
                                | Promote
                    header.entity--header
                        .entity--title= event.title
                        .entity--meta.meta
                            .entity--tags
                                for story in event.stories
                                    a(href=url_for('main.story', id=story.id))= story.title
                                    if not loop.last
                                        ,
                            .entity--time= event.updated_at|naturaltime
                    section.entity--summary
                        p= event.summary|highlight_mentions(event.mentions)|sanitize_html
                        .entity--meta.meta This summary was automatically generated from the articles below.

                    +articles('In Greater Depth', event.articles)

                    //- TO DO: what about events which belong to multiple stories?
                    - var story_events = event.stories[0].events_before(event.created_at).remove(event)
                    .heading.entity--story--heading
                        | Previously in this story
                        a(href=url_for('main.story', id=event.stories[0].id)) View the full timeline
                    if story_events
                        section.entity--story
                            ul
                                for rel_event in story_events
                                    li
                                        .event--thumb
                                            img(src=rel_event.image)
                                        .event--info
                                            .event--title= rel_event.title
                                            .meta= rel_event.updated_at|naturaltime
                                            p= rel_event.summary|truncate(length=400)|highlight_mentions(rel_event.mentions)|sanitize_html
                    else
                        .empty There are no other events in this story yet.

                +mentions('Mentioned in this event', event.concepts)
