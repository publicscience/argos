- from 'mixins/mentions.jade' import mentions
- from 'mixins/articles.jade' import articles

extends layouts/main.jade

block content
    .bounds
        article.entity.clearfix
            .entity--hero(style='background-image:url("'+story.image+'")')
            .entity--body.clearfix
                .entity--content
                    section
                        ul.actions.list__horizontal__justify
                            li
                                span.icon-watch
                                | Watch
                            li
                                span.icon-bookmark
                                | Bookmark
                            li
                                span.icon-discuss
                                | Discuss
                            li
                                span.icon-share
                                | Share
                            li
                                span.icon-promote
                                | Promote
                    header.entity--header
                        .entity--title= story.title
                        .entity--meta.meta
                            .entity--tags foo
                            .entity--time Last updated {{ story.updated_at|natural_datetime }}
                    section.entity--summary
                        p= story.summary|highlight_mentions(story.mentions)|sanitize_html
                        .entity--meta.meta This summary was automatically generated from the articles below.

                    //- TO DO: right now this just grabs from the first event,
                    //- but it should be across all of this story's events.
                    +articles('Most shared articles in this story', story.events[0].articles)

                    .heading.entity--story--heading
                        | The full timeline
                        if request.args.get('order', 'desc') == 'desc'
                            a(href='?order=asc') Most recent to oldest ⇅
                        else:
                            a(href='?order=desc') Oldest to most recent ⇅
                    section.entity--timeline
                        .entity--timeline-date
                            for group in story.events_by_date()
                                .subheading {{ group[0]|format_date }} ({{ group[0]|natural_date }})
                                ul.story--event-group
                                    for event in group[1]
                                        li
                                            .event--thumb
                                                img(src=event.image)
                                            .event--info
                                                .event--title
                                                    a(href=url_for('main.event', id=event.id))= event.title
                                                ul.actions.list__horizontal__justify

                                                    li
                                                        if event in current_user.bookmarked
                                                            a(href=url_for('main.bookmark', event_id=event.id), data-method='DELETE', data-mapping='bookmark').active
                                                                span.icon-bookmark
                                                                span.action-label Bookmarked
                                                        else
                                                            a(href=url_for('main.bookmark', event_id=event.id), data-method='POST', data-mapping='bookmark')
                                                                span.icon-bookmark
                                                                span.action-label Bookmark
                                                    li
                                                        span.icon-discuss
                                                        | Discuss
                                                    li
                                                        span.icon-share
                                                        | Share
                                                    li
                                                        span.icon-promote
                                                        | Promote
                                                p= event.summary|highlight_mentions(event.mentions)|sanitize_html

                +mentions('Mentioned in this story', story.concepts)
